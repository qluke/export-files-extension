<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VSCodeæ’ä»¶å¼€å‘æŒ‡å—</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
            border-left: 4px solid #3498db;
            padding-left: 15px;
        }
        .step {
            background: #ecf0f1;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        .file-structure {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            overflow-x: auto;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            overflow-x: auto;
        }
        .code-block pre {
            margin: 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
        }
        .button {
            background: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 14px;
        }
        .button:hover {
            background: #2980b9;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            background: #f8f9fa;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }
        .tab.active {
            border-bottom: 2px solid #3498db;
            background: white;
            color: #3498db;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 15px;
            }
            .tabs {
                flex-direction: column;
            }
            .tab {
                margin-right: 0;
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ VSCodeæ–‡ä»¶å¯¼å‡ºæ’ä»¶å¼€å‘æŒ‡å—</h1>
        
        <div class="tabs">
            <div class="tab active" onclick="showTab('setup')">1. æ’ä»¶åˆå§‹åŒ–</div>
            <div class="tab" onclick="showTab('files')">2. æ–‡ä»¶ç»“æ„</div>
            <div class="tab" onclick="showTab('code')">3. æ ¸å¿ƒä»£ç </div>
            <div class="tab" onclick="showTab('package')">4. æ‰“åŒ…å‘å¸ƒ</div>
        </div>

        <div id="setup" class="tab-content active">
            <h2>ğŸ“ æ’ä»¶åˆå§‹åŒ–</h2>
            
            <div class="step">
                <h3>æ­¥éª¤1: å®‰è£…å¿…è¦å·¥å…·</h3>
                <div class="code-block">
                    <pre># å®‰è£…VSCodeæ’ä»¶å¼€å‘å·¥å…·
npm install -g yo generator-code

# åˆ›å»ºæ–°æ’ä»¶
yo code</pre>
                </div>
                <p>é€‰æ‹©é…ç½®ï¼š</p>
                <ul>
                    <li>New Extension (TypeScript)</li>
                    <li>æ’ä»¶åç§°: export-files-extension</li>
                    <li>æ ‡è¯†ç¬¦: export-files-extension</li>
                    <li>æè¿°: å¯¼å‡ºæ–‡ä»¶å¤¹å†…å®¹åˆ°Markdownæ–‡ä»¶</li>
                    <li>åˆå§‹åŒ–gitä»“åº“: Yes</li>
                    <li>å®‰è£…ä¾èµ–: Yes</li>
                </ul>
            </div>

            <div class="warning">
                <strong>âš ï¸ æ³¨æ„ï¼š</strong>ç¡®ä¿æ‚¨å·²ç»å®‰è£…äº†Node.jså’Œnpmï¼Œå¹¶ä¸”VSCodeå·²å®‰è£…Extension Development Hostã€‚
            </div>
        </div>

        <div id="files" class="tab-content">
            <h2>ğŸ“‚ é¡¹ç›®æ–‡ä»¶ç»“æ„</h2>
            
            <div class="file-structure">
export-files-extension/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ extension.ts           # ä¸»æ‰©å±•æ–‡ä»¶
â”‚   â”œâ”€â”€ exportFiles.ts         # æ–‡ä»¶å¯¼å‡ºé€»è¾‘
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ fileUtils.ts       # æ–‡ä»¶å¤„ç†å·¥å…·
â”‚       â””â”€â”€ markdownGen.ts     # Markdownç”Ÿæˆå™¨
â”œâ”€â”€ package.json               # æ’ä»¶é…ç½®
â”œâ”€â”€ tsconfig.json              # TypeScripté…ç½®
â”œâ”€â”€ .vscodeignore             # æ‰“åŒ…å¿½ç•¥æ–‡ä»¶
â””â”€â”€ README.md                 # è¯´æ˜æ–‡æ¡£
            </div>

            <div class="step">
                <h3>åˆ›å»ºå¿…è¦çš„æ–‡ä»¶å¤¹å’Œæ–‡ä»¶</h3>
                <div class="code-block">
                    <pre># åœ¨æ’ä»¶æ ¹ç›®å½•æ‰§è¡Œ
mkdir src/utils
touch src/exportFiles.ts
touch src/utils/fileUtils.ts
touch src/utils/markdownGen.ts</pre>
                </div>
            </div>
        </div>

        <div id="code" class="tab-content">
            <h2>ğŸ’» æ ¸å¿ƒä»£ç å®ç°</h2>

            <div class="step">
                <h3>1. package.json é…ç½®</h3>
                <div class="code-block">
                    <pre>{
  "name": "export-files-extension",
  "displayName": "æ–‡ä»¶å¯¼å‡ºå™¨",
  "description": "å°†æ–‡ä»¶å¤¹å†…å®¹å¯¼å‡ºä¸ºMarkdownæ–‡ä»¶",
  "version": "1.0.0",
  "engines": {
    "vscode": "^1.74.0"
  },
  "categories": ["Other"],
  "activationEvents": [],
  "main": "./out/extension.js",
  "contributes": {
    "commands": [
      {
        "command": "exportFiles.exportToMarkdown",
        "title": "å¯¼å‡ºä¸ºMarkdownæ–‡ä»¶",
        "icon": "$(file-text)"
      }
    ],
    "menus": {
      "explorer/context": [
        {
          "command": "exportFiles.exportToMarkdown",
          "when": "explorerResourceIsFolder",
          "group": "7_modification"
        }
      ]
    }
  },
  "scripts": {
    "vscode:prepublish": "npm run compile",
    "compile": "tsc -p ./",
    "watch": "tsc -watch -p ./"
  },
  "devDependencies": {
    "@types/vscode": "^1.74.0",
    "@types/node": "16.x",
    "typescript": "^4.9.4"
  }
}</pre>
                </div>
            </div>

            <div class="step">
                <h3>2. ä¸»æ‰©å±•æ–‡ä»¶ (src/extension.ts)</h3>
                <div class="code-block">
                    <pre>import * as vscode from 'vscode';
import { exportFilesToMarkdown } from './exportFiles';

export function activate(context: vscode.ExtensionContext) {
    console.log('æ–‡ä»¶å¯¼å‡ºæ’ä»¶å·²æ¿€æ´»');

    const disposable = vscode.commands.registerCommand(
        'exportFiles.exportToMarkdown', 
        async (uri: vscode.Uri) => {
            if (uri && uri.fsPath) {
                await exportFilesToMarkdown(uri.fsPath);
            } else {
                vscode.window.showErrorMessage('è¯·é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶å¤¹');
            }
        }
    );

    context.subscriptions.push(disposable);
}

export function deactivate() {}</pre>
                </div>
            </div>

            <div class="step">
                <h3>3. æ–‡ä»¶å¯¼å‡ºé€»è¾‘ (src/exportFiles.ts)</h3>
                <div class="code-block">
                    <pre>import * as vscode from 'vscode';
import * as path from 'path';
import { FileExporter } from './utils/fileUtils';
import { MarkdownGenerator } from './utils/markdownGen';

export async function exportFilesToMarkdown(folderPath: string) {
    try {
        // æ˜¾ç¤ºè¾“å…¥æ¡†è®©ç”¨æˆ·é€‰æ‹©è¾“å‡ºæ–‡ä»¶å
        const outputFileName = await vscode.window.showInputBox({
            prompt: 'è¯·è¾“å…¥è¾“å‡ºæ–‡ä»¶å',
            value: 'project-files.md',
            validateInput: (value) => {
                if (!value || !value.trim()) {
                    return 'æ–‡ä»¶åä¸èƒ½ä¸ºç©º';
                }
                if (!value.endsWith('.md')) {
                    return 'æ–‡ä»¶åå¿…é¡»ä»¥.mdç»“å°¾';
                }
                return null;
            }
        });

        if (!outputFileName) {
            return;
        }

        // æ˜¾ç¤ºè¿›åº¦æ¡
        await vscode.window.withProgress({
            location: vscode.ProgressLocation.Notification,
            title: "æ­£åœ¨å¯¼å‡ºæ–‡ä»¶...",
            cancellable: false
        }, async (progress) => {
            progress.report({ increment: 0 });

            const fileExporter = new FileExporter(folderPath);
            const markdownGen = new MarkdownGenerator();

            progress.report({ increment: 30, message: "æ‰«ææ–‡ä»¶..." });
            const files = await fileExporter.getAllFiles();

            progress.report({ increment: 60, message: "ç”ŸæˆMarkdown..." });
            const markdownContent = await markdownGen.generateMarkdown(
                folderPath, 
                files,
                outputFileName
            );

            progress.report({ increment: 90, message: "ä¿å­˜æ–‡ä»¶..." });
            const outputPath = path.join(folderPath, outputFileName);
            await fileExporter.writeFile(outputPath, markdownContent);

            progress.report({ increment: 100 });
        });

        vscode.window.showInformationMessage(
            `æ–‡ä»¶å¯¼å‡ºæˆåŠŸï¼ä¿å­˜è‡³: ${outputFileName}`,
            'æ‰“å¼€æ–‡ä»¶'
        ).then(selection => {
            if (selection === 'æ‰“å¼€æ–‡ä»¶') {
                vscode.workspace.openTextDocument(
                    path.join(folderPath, outputFileName)
                ).then(doc => {
                    vscode.window.showTextDocument(doc);
                });
            }
        });

    } catch (error) {
        vscode.window.showErrorMessage(`å¯¼å‡ºå¤±è´¥: ${error}`);
    }
}</pre>
                </div>
            </div>

            <div class="step">
                <h3>4. æ–‡ä»¶å¤„ç†å·¥å…· (src/utils/fileUtils.ts)</h3>
                <div class="code-block">
                    <pre>import * as fs from 'fs';
import * as path from 'path';
import { promisify } from 'util';

const readdir = promisify(fs.readdir);
const stat = promisify(fs.stat);
const readFile = promisify(fs.readFile);
const writeFile = promisify(fs.writeFile);

export interface FileInfo {
    path: string;
    relativePath: string;
    content: string;
    size: number;
    extension: string;
}

export class FileExporter {
    private basePath: string;
    private config = {
        ignore: [
            'node_modules', '.git', '.next', 'dist', 'build', 'coverage',
            '.env', '.DS_Store', 'Thumbs.db', '.vercel'
        ],
        ignoreExtensions: [
            '.jpg', '.jpeg', '.png', '.gif', '.svg', '.ico', '.webp',
            '.pdf', '.zip', '.rar', '.7z', '.ttf', '.woff', '.woff2'
        ],
        maxFileSize: 1024 * 1024 // 1MB
    };

    constructor(basePath: string) {
        this.basePath = basePath;
    }

    async getAllFiles(): Promise<FileInfo[]> {
        const files: FileInfo[] = [];
        await this.scanDirectory(this.basePath, files);
        return files.sort((a, b) => a.relativePath.localeCompare(b.relativePath));
    }

    private async scanDirectory(dir: string, files: FileInfo[]): Promise<void> {
        try {
            const items = await readdir(dir);
            
            for (const item of items) {
                const fullPath = path.join(dir, item);
                
                if (this.shouldIgnore(fullPath)) {
                    continue;
                }

                const stats = await stat(fullPath);
                
                if (stats.isDirectory()) {
                    await this.scanDirectory(fullPath, files);
                } else if (stats.isFile()) {
                    if (stats.size > this.config.maxFileSize) {
                        continue;
                    }

                    try {
                        const content = await readFile(fullPath, 'utf8');
                        const relativePath = path.relative(this.basePath, fullPath);
                        
                        files.push({
                            path: fullPath,
                            relativePath,
                            content,
                            size: stats.size,
                            extension: path.extname(fullPath).toLowerCase()
                        });
                    } catch (error) {
                        // è·³è¿‡æ— æ³•è¯»å–çš„æ–‡ä»¶
                        console.log(`è·³è¿‡æ–‡ä»¶: ${fullPath}`);
                    }
                }
            }
        } catch (error) {
            console.error(`æ— æ³•è¯»å–ç›®å½•: ${dir}`, error);
        }
    }

    private shouldIgnore(filePath: string): boolean {
        const basename = path.basename(filePath);
        const ext = path.extname(filePath).toLowerCase();

        return this.config.ignore.includes(basename) ||
               this.config.ignoreExtensions.includes(ext) ||
               filePath.includes('node_modules') ||
               filePath.includes('.git');
    }

    async writeFile(filePath: string, content: string): Promise<void> {
        await writeFile(filePath, content, 'utf8');
    }
}</pre>
                </div>
            </div>

            <div class="step">
                <h3>5. Markdownç”Ÿæˆå™¨ (src/utils/markdownGen.ts)</h3>
                <div class="code-block">
                    <pre>import * as path from 'path';
import { FileInfo } from './fileUtils';

export class MarkdownGenerator {
    private getLanguage(filePath: string): string {
        const ext = path.extname(filePath).toLowerCase();
        const languageMap: { [key: string]: string } = {
            '.js': 'javascript',
            '.jsx': 'jsx',
            '.ts': 'typescript',
            '.tsx': 'tsx',
            '.html': 'html',
            '.css': 'css',
            '.scss': 'scss',
            '.json': 'json',
            '.md': 'markdown',
            '.py': 'python',
            '.java': 'java',
            '.c': 'c',
            '.cpp': 'cpp',
            '.go': 'go',
            '.rs': 'rust',
            '.php': 'php',
            '.sh': 'bash',
            '.sql': 'sql',
            '.xml': 'xml',
            '.yaml': 'yaml',
            '.yml': 'yaml'
        };
        return languageMap[ext] || 'plaintext';
    }

    private formatFileSize(bytes: number): string {
        if (bytes < 1024) return bytes + ' bytes';
        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
        return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    }

    async generateMarkdown(
        basePath: string, 
        files: FileInfo[], 
        outputFileName: string
    ): Promise<string> {
        let content = `# é¡¹ç›®æ–‡ä»¶å¯¼å‡º\n\n`;
        content += `å¯¼å‡ºæ—¶é—´: ${new Date().toLocaleString()}\n\n`;
        content += `æºç›®å½•: \`${path.basename(basePath)}\`\n\n`;

        // æ–‡ä»¶ç»Ÿè®¡
        const totalSize = files.reduce((sum, file) => sum + file.size, 0);
        const extensionStats: { [key: string]: { count: number; size: number } } = {};

        files.forEach(file => {
            const ext = file.extension || '(æ— æ‰©å±•å)';
            if (!extensionStats[ext]) {
                extensionStats[ext] = { count: 0, size: 0 };
            }
            extensionStats[ext].count++;
            extensionStats[ext].size += file.size;
        });

        content += `## æ–‡ä»¶ç»Ÿè®¡\n\n`;
        content += `- æ€»æ–‡ä»¶æ•°: ${files.length}\n`;
        content += `- æ€»å¤§å°: ${this.formatFileSize(totalSize)}\n\n`;

        // æ–‡ä»¶ç±»å‹åˆ†å¸ƒ
        if (Object.keys(extensionStats).length > 0) {
            content += `### æ–‡ä»¶ç±»å‹åˆ†å¸ƒ\n\n`;
            content += `| æ‰©å±•å | æ–‡ä»¶æ•° | æ€»å¤§å° |\n`;
            content += `| --- | --- | --- |\n`;

            Object.entries(extensionStats)
                .sort((a, b) => b[1].count - a[1].count)
                .forEach(([ext, stats]) => {
                    content += `| ${ext} | ${stats.count} | ${this.formatFileSize(stats.size)} |\n`;
                });

            content += `\n`;
        }

        // æ–‡ä»¶å†…å®¹
        content += `## æ–‡ä»¶å†…å®¹\n\n`;

        for (const file of files) {
            const language = this.getLanguage(file.path);
            content += `### ${file.relativePath}\n\n`;
            content += `\`\`\`${language}\n`;
            content += `// ${file.relativePath}\n`;
            content += file.content;
            content += `\n\`\`\`\n\n`;
        }

        return content;
    }
}</pre>
                </div>
            </div>
        </div>

        <div id="package" class="tab-content">
            <h2>ğŸ“¦ æ‰“åŒ…å’Œå‘å¸ƒ</h2>

            <div class="step">
                <h3>1. ç¼–è¯‘æ’ä»¶</h3>
                <div class="code-block">
                    <pre># ç¼–è¯‘TypeScript
npm run compile

# æˆ–è€…ä½¿ç”¨ç›‘å¬æ¨¡å¼
npm run watch</pre>
                </div>
            </div>

            <div class="step">
                <h3>2. æµ‹è¯•æ’ä»¶</h3>
                <p>åœ¨VSCodeä¸­æŒ‰ <code>F5</code> å¯åŠ¨æ’ä»¶å¼€å‘ä¸»æœºï¼Œç„¶åï¼š</p>
                <ol>
                    <li>æ‰“å¼€ä¸€ä¸ªåŒ…å«æ–‡ä»¶çš„æ–‡ä»¶å¤¹</li>
                    <li>åœ¨èµ„æºç®¡ç†å™¨ä¸­å³é”®ç‚¹å‡»ä»»æ„æ–‡ä»¶å¤¹</li>
                    <li>é€‰æ‹©"å¯¼å‡ºä¸ºMarkdownæ–‡ä»¶"</li>
                    <li>è¾“å…¥è¾“å‡ºæ–‡ä»¶å</li>
                    <li>æŸ¥çœ‹ç”Ÿæˆçš„Markdownæ–‡ä»¶</li>
                </ol>
            </div>

            <div class="step">
                <h3>3. æ‰“åŒ…æ’ä»¶</h3>
                <div class="code-block">
                    <pre># å®‰è£…æ‰“åŒ…å·¥å…·
npm install -g vsce

# æ‰“åŒ…æ’ä»¶
vsce package

# è¿™å°†ç”Ÿæˆ .vsix æ–‡ä»¶</pre>
                </div>
            </div>

            <div class="step">
                <h3>4. å®‰è£…æ’ä»¶</h3>
                <p>æœ‰ä¸¤ç§æ–¹å¼å®‰è£…æ’ä»¶ï¼š</p>
                <div class="code-block">
                    <pre># æ–¹å¼1: å‘½ä»¤è¡Œå®‰è£…
code --install-extension export-files-extension-1.0.0.vsix

# æ–¹å¼2: VSCodeç•Œé¢å®‰è£…
# æ‰“å¼€VSCode -> æ‰©å±• -> ... -> ä»VSIXå®‰è£…</pre>
                </div>
            </div>

            <div class="success">
                <strong>ğŸ‰ å®Œæˆï¼</strong>æ‚¨çš„VSCodeæ’ä»¶å·²ç»å¼€å‘å®Œæˆã€‚ç°åœ¨å¯ä»¥åœ¨ä»»ä½•æ–‡ä»¶å¤¹ä¸Šå³é”®é€‰æ‹©"å¯¼å‡ºä¸ºMarkdownæ–‡ä»¶"æ¥ä½¿ç”¨æ‚¨çš„è„šæœ¬åŠŸèƒ½äº†ã€‚
            </div>

            <div class="step">
                <h3>5. å¯é€‰ï¼šå‘å¸ƒåˆ°å¸‚åœº</h3>
                <p>å¦‚æœæ‚¨æƒ³å°†æ’ä»¶å‘å¸ƒåˆ°VSCodeå¸‚åœºï¼š</p>
                <div class="code-block">
                    <pre># åˆ›å»ºå‘å¸ƒè€…è´¦å·å¹¶è·å–token
# è®¿é—® https://marketplace.visualstudio.com/manage

# ç™»å½•å¹¶å‘å¸ƒ
vsce login [publisher-name]
vsce publish</pre>
                </div>
            </div>
        </div>

        <div class="warning">
            <strong>ğŸ’¡ æç¤ºï¼š</strong>
            <ul>
                <li>æ’ä»¶ä¼šè‡ªåŠ¨å¿½ç•¥å¸¸è§çš„ä¸éœ€è¦å¯¼å‡ºçš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹</li>
                <li>æ”¯æŒæ‰€æœ‰ä¸»æµç¼–ç¨‹è¯­è¨€çš„è¯­æ³•é«˜äº®</li>
                <li>åŒ…å«æ–‡ä»¶ç»Ÿè®¡å’Œç›®å½•ç»“æ„ä¿¡æ¯</li>
                <li>å¯ä»¥è‡ªå®šä¹‰è¾“å‡ºæ–‡ä»¶å</li>
                <li>æ˜¾ç¤ºå¯¼å‡ºè¿›åº¦</li>
            </ul>
        </div>
    </div>

    <script>
        function showTab(tabId) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => {
                content.classList.remove('active');
            });

            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„activeç±»
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });

            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾å†…å®¹
            document.getElementById(tabId).classList.add('active');
            
            // æ·»åŠ activeç±»åˆ°é€‰ä¸­çš„æ ‡ç­¾
            event.target.classList.add('active');
        }
    </script>
</body>
</html>